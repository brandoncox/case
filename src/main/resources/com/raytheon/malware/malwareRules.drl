package com.raytheon.malware;
import org.kie.api.runtime.process.WorkflowProcessInstance;
import java.util.Map;

rule "determine if there is a submission"
    ruleflow-group "malware-rules"
    dialect "mvel"
    when
        exists sub: Submission()
    then
        System.out.println("the submission exists");
end
    

rule "determine path dynamic"
    ruleflow-group "malware-rules"
    dialect "mvel"
    
    when
        $obj1 :Map(this["analysisType"] == "DYNAMIC")
        $process : WorkflowProcessInstance( )
    then
        System.out.println("the path will be dynamic");
        WorkflowProcessInstance $p = (WorkflowProcessInstance)kcontext.getKieRuntime().getProcessInstance($process.getId()); //casting to WorkflowProcessInstance is essential
        $p.setVariable( "PATH","DYNAMIC" );
        retract($process);
end

rule "determine path static"
    ruleflow-group "malware-rules"
    dialect "mvel"
    
    when
        $obj1 :Map(this["analysisType"] == "STATIC")
        $process : WorkflowProcessInstance( )
    then
        System.out.println("the path will be static");
        WorkflowProcessInstance $p = (WorkflowProcessInstance)kcontext.getKieRuntime().getProcessInstance($process.getId()); //casting to WorkflowProcessInstance is essential
        $p.setVariable( "PATH","STATIC" );
        retract($process);
end
